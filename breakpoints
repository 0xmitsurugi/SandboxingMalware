echo \n\n\n
echo ###################################\n
echo #  Starting instrumented binary\n
echo ###################################\n\n
echo \                             Nothing ventured, nothing gained.\n
echo \              You can't do anything without risking something.\n
echo \n\n\n


#Skip all forks at the beginning of main()
b * 0x4067d0
commands
echo Skipping all the forks\n
echo and the setsid\n
set $rip=0x406842
c
end

#Connection start: let's grab IP of C&C
#tip: readelf -x .rodata Rx64 | head -1
#We're inside initConnection()
b * 0x406466
commands
echo We got currentServer!\n
x/s commServer
echo Continuing...\n
c
end

#After connection win
#back to main
b * 0x40689b
commands
echo Back to main\n
echo Jumping all code related to forks\n
set $rip=0x4069da
c
end

#This is the interesting part, C&C sending commands
#TODO: save those somewhere? in a file?
b * 0x4069df
commands
echo *******************************\n
echo * C&C is talking to us:\n
echo *
x/s $rbp-0x14c0
echo *******************************\n
c
end

#C&C sends us "DUP" which means EXIT
b * 0x406a4d
commands
echo ########################\n
echo  C&C asks us to leave with "DUP" commands\n
echo Bye.\n
echo ########################\n
c
end

#C&C sends a SH command
b * 0x406c4d
commands
echo /!\\ DANGER: SHELL /!\\\n
echo C&C sends a shell command\n
echo Will safely ignore it\n
set $rip=0x406d02
c
end

#C&C sends a command
b * 0x406e0b
commands
echo /!\\ DANGER: COMMAND /!\\\n
echo C&C sends a command\n
echo Will safely ignore it\n
set $rip=0x406e10
c
end
